/* eslint-disable */
"use strict";

// external tooling

var valueParser = require("postcss-value-parser");

// extended tooling
var stringify = valueParser.stringify;

function split(params, start) {
  var list = [];
  var last = params.reduce(function (item, node, index) {
    if (index < start) return "";
    if (node.type === "div" && node.value === ",") {
      list.push(item);
      return "";
    }
    return item + stringify(node);
  }, "");
  list.push(last);
  return list;
}

module.exports = function (result, styles) {
  var statements = [];
  var nodes = [];

  styles.each(function (node) {
    var stmt = void 0;
    if (node.type === "atrule") {
      if (node.name === "import") stmt = parseImport(result, node);else if (node.name === "media") stmt = parseMedia(result, node);
    }

    if (stmt) {
      if (nodes.length) {
        statements.push({
          type: "nodes",
          nodes: nodes,
          media: []
        });
        nodes = [];
      }
      statements.push(stmt);
    } else nodes.push(node);
  });

  if (nodes.length) {
    statements.push({
      type: "nodes",
      nodes: nodes,
      media: []
    });
  }

  return statements;
};

function parseMedia(result, atRule) {
  var params = valueParser(atRule.params).nodes;
  return {
    type: "media",
    node: atRule,
    media: split(params, 0)
  };
}

function parseImport(result, atRule) {
  var prev = getPrev(atRule);
  if (prev) {
    do {
      // if (
      //   prev.type !== "atrule" ||
      //   (prev.name !== "import" && prev.name !== "charset")
      // ) {
      //   return result.warn(
      //     "@import must precede all other statements (besides @charset)",
      //     { node: atRule }
      //   )
      // } else prev = getPrev(prev)
      prev = getPrev(prev);
    } while (prev);
  }

  if (atRule.nodes) {
    return result.warn("It looks like you didn't end your @import statement correctly. " + "Child nodes are attached to it.", { node: atRule });
  }

  var params = valueParser(atRule.params).nodes;
  var stmt = {
    type: "import",
    node: atRule,
    media: []

    // prettier-ignore
  };if (!params.length || (params[0].type !== "string" || !params[0].value) && (params[0].type !== "function" || params[0].value !== "url" || !params[0].nodes.length || !params[0].nodes[0].value)) {
    return result.warn("Unable to find uri in '" + atRule.toString() + "'", {
      node: atRule
    });
  }

  if (params[0].type === "string") stmt.uri = params[0].value;else stmt.uri = params[0].nodes[0].value;
  stmt.fullUri = stringify(params[0]);

  if (params.length > 2) {
    if (params[1].type !== "space") {
      return result.warn("Invalid import media statement", { node: atRule });
    }
    stmt.media = split(params, 2);
  }

  return stmt;
}

function getPrev(item) {
  var prev = item.prev();
  while (prev && prev.type === "comment") {
    prev = prev.prev();
  }
  return prev;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wb3N0Y3NzLWltcG9ydC9saWIvcGFyc2Utc3RhdGVtZW50cy5qcyJdLCJuYW1lcyI6WyJ2YWx1ZVBhcnNlciIsInJlcXVpcmUiLCJzdHJpbmdpZnkiLCJzcGxpdCIsInBhcmFtcyIsInN0YXJ0IiwibGlzdCIsImxhc3QiLCJyZWR1Y2UiLCJpdGVtIiwibm9kZSIsImluZGV4IiwidHlwZSIsInZhbHVlIiwicHVzaCIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZXN1bHQiLCJzdHlsZXMiLCJzdGF0ZW1lbnRzIiwibm9kZXMiLCJlYWNoIiwic3RtdCIsIm5hbWUiLCJwYXJzZUltcG9ydCIsInBhcnNlTWVkaWEiLCJsZW5ndGgiLCJtZWRpYSIsImF0UnVsZSIsInByZXYiLCJnZXRQcmV2Iiwid2FybiIsInRvU3RyaW5nIiwidXJpIiwiZnVsbFVyaSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTs7QUFFQTs7QUFDQSxJQUFNQSxjQUFjQyxRQUFRLHNCQUFSLENBQXBCOztBQUVBO0FBQ0EsSUFBTUMsWUFBWUYsWUFBWUUsU0FBOUI7O0FBRUEsU0FBU0MsS0FBVCxDQUFlQyxNQUFmLEVBQXVCQyxLQUF2QixFQUE4QjtBQUM1QixNQUFNQyxPQUFPLEVBQWI7QUFDQSxNQUFNQyxPQUFPSCxPQUFPSSxNQUFQLENBQWMsVUFBQ0MsSUFBRCxFQUFPQyxJQUFQLEVBQWFDLEtBQWIsRUFBdUI7QUFDaEQsUUFBSUEsUUFBUU4sS0FBWixFQUFtQixPQUFPLEVBQVA7QUFDbkIsUUFBSUssS0FBS0UsSUFBTCxLQUFjLEtBQWQsSUFBdUJGLEtBQUtHLEtBQUwsS0FBZSxHQUExQyxFQUErQztBQUM3Q1AsV0FBS1EsSUFBTCxDQUFVTCxJQUFWO0FBQ0EsYUFBTyxFQUFQO0FBQ0Q7QUFDRCxXQUFPQSxPQUFPUCxVQUFVUSxJQUFWLENBQWQ7QUFDRCxHQVBZLEVBT1YsRUFQVSxDQUFiO0FBUUFKLE9BQUtRLElBQUwsQ0FBVVAsSUFBVjtBQUNBLFNBQU9ELElBQVA7QUFD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QixRQUF2QixFQUFpQ1UsS0FBS1csR0FBTCxHQUFXN0IsT0FBTyxDQUFQLEVBQVVTLEtBQXJCLENBQWpDLEtBQ0tTLEtBQUtXLEdBQUwsR0FBVzdCLE9BQU8sQ0FBUCxFQUFVZ0IsS0FBVixDQUFnQixDQUFoQixFQUFtQlAsS0FBOUI7QUFDTFMsT0FBS1ksT0FBTCxHQUFlaEMsVUFBVUUsT0FBTyxDQUFQLENBQVYsQ0FBZjs7QUFFQSxNQUFJQSxPQUFPc0IsTUFBUCxHQUFnQixDQUFwQixFQUF1QjtBQUNyQixRQUFJdEIsT0FBTyxDQUFQLEVBQVVRLElBQVYsS0FBbUIsT0FBdkIsRUFBZ0M7QUFDOUIsYUFBT0ssT0FBT2MsSUFBUCxDQUFZLGdDQUFaLEVBQThDLEVBQUVyQixNQUFNa0IsTUFBUixFQUE5QyxDQUFQO0FBQ0Q7QUFDRE4sU0FBS0ssS0FBTCxHQUFheEIsTUFBTUMsTUFBTixFQUFjLENBQWQsQ0FBYjtBQUNEOztBQUVELFNBQU9rQixJQUFQO0FBQ0Q7O0FBRUQsU0FBU1EsT0FBVCxDQUFpQnJCLElBQWpCLEVBQXVCO0FBQ3JCLE1BQUlvQixPQUFPcEIsS0FBS29CLElBQUwsRUFBWDtBQUNBLFNBQU9BLFFBQVFBLEtBQUtqQixJQUFMLEtBQWMsU0FBN0IsRUFBd0M7QUFDdENpQixXQUFPQSxLQUFLQSxJQUFMLEVBQVA7QUFDRDtBQUNELFNBQU9BLElBQVA7QUFDRCIsImZpbGUiOiJwYXJzZS1zdGF0ZW1lbnRzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgKi9cblwidXNlIHN0cmljdFwiXG5cbi8vIGV4dGVybmFsIHRvb2xpbmdcbmNvbnN0IHZhbHVlUGFyc2VyID0gcmVxdWlyZShcInBvc3Rjc3MtdmFsdWUtcGFyc2VyXCIpXG5cbi8vIGV4dGVuZGVkIHRvb2xpbmdcbmNvbnN0IHN0cmluZ2lmeSA9IHZhbHVlUGFyc2VyLnN0cmluZ2lmeVxuXG5mdW5jdGlvbiBzcGxpdChwYXJhbXMsIHN0YXJ0KSB7XG4gIGNvbnN0IGxpc3QgPSBbXVxuICBjb25zdCBsYXN0ID0gcGFyYW1zLnJlZHVjZSgoaXRlbSwgbm9kZSwgaW5kZXgpID0+IHtcbiAgICBpZiAoaW5kZXggPCBzdGFydCkgcmV0dXJuIFwiXCJcbiAgICBpZiAobm9kZS50eXBlID09PSBcImRpdlwiICYmIG5vZGUudmFsdWUgPT09IFwiLFwiKSB7XG4gICAgICBsaXN0LnB1c2goaXRlbSlcbiAgICAgIHJldHVybiBcIlwiXG4gICAgfVxuICAgIHJldHVybiBpdGVtICsgc3RyaW5naWZ5KG5vZGUpXG4gIH0sIFwiXCIpXG4gIGxpc3QucHVzaChsYXN0KVxuICByZXR1cm4gbGlzdFxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHJlc3VsdCwgc3R5bGVzKSB7XG4gIGNvbnN0IHN0YXRlbWVudHMgPSBbXVxuICBsZXQgbm9kZXMgPSBbXVxuXG4gIHN0eWxlcy5lYWNoKG5vZGUgPT4ge1xuICAgIGxldCBzdG10XG4gICAgaWYgKG5vZGUudHlwZSA9PT0gXCJhdHJ1bGVcIikge1xuICAgICAgaWYgKG5vZGUubmFtZSA9PT0gXCJpbXBvcnRcIikgc3RtdCA9IHBhcnNlSW1wb3J0KHJlc3VsdCwgbm9kZSlcbiAgICAgIGVsc2UgaWYgKG5vZGUubmFtZSA9PT0gXCJtZWRpYVwiKSBzdG10ID0gcGFyc2VNZWRpYShyZXN1bHQsIG5vZGUpXG4gICAgfVxuXG4gICAgaWYgKHN0bXQpIHtcbiAgICAgIGlmIChub2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgc3RhdGVtZW50cy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiBcIm5vZGVzXCIsXG4gICAgICAgICAgbm9kZXM6IG5vZGVzLFxuICAgICAgICAgIG1lZGlhOiBbXSxcbiAgICAgICAgfSlcbiAgICAgICAgbm9kZXMgPSBbXVxuICAgICAgfVxuICAgICAgc3RhdGVtZW50cy5wdXNoKHN0bXQpXG4gICAgfSBlbHNlIG5vZGVzLnB1c2gobm9kZSlcbiAgfSlcblxuICBpZiAobm9kZXMubGVuZ3RoKSB7XG4gICAgc3RhdGVtZW50cy5wdXNoKHtcbiAgICAgIHR5cGU6IFwibm9kZXNcIixcbiAgICAgIG5vZGVzOiBub2RlcyxcbiAgICAgIG1lZGlhOiBbXSxcbiAgICB9KVxuICB9XG5cbiAgcmV0dXJuIHN0YXRlbWVudHNcbn1cblxuZnVuY3Rpb24gcGFyc2VNZWRpYShyZXN1bHQsIGF0UnVsZSkge1xuICBjb25zdCBwYXJhbXMgPSB2YWx1ZVBhcnNlcihhdFJ1bGUucGFyYW1zKS5ub2Rlc1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwibWVkaWFcIixcbiAgICBub2RlOiBhdFJ1bGUsXG4gICAgbWVkaWE6IHNwbGl0KHBhcmFtcywgMCksXG4gIH1cbn1cblxuZnVuY3Rpb24gcGFyc2VJbXBvcnQocmVzdWx0LCBhdFJ1bGUpIHtcbiAgbGV0IHByZXYgPSBnZXRQcmV2KGF0UnVsZSlcbiAgaWYgKHByZXYpIHtcbiAgICBkbyB7XG4gICAgICAvLyBpZiAoXG4gICAgICAvLyAgIHByZXYudHlwZSAhPT0gXCJhdHJ1bGVcIiB8fFxuICAgICAgLy8gICAocHJldi5uYW1lICE9PSBcImltcG9ydFwiICYmIHByZXYubmFtZSAhPT0gXCJjaGFyc2V0XCIpXG4gICAgICAvLyApIHtcbiAgICAgIC8vICAgcmV0dXJuIHJlc3VsdC53YXJuKFxuICAgICAgLy8gICAgIFwiQGltcG9ydCBtdXN0IHByZWNlZGUgYWxsIG90aGVyIHN0YXRlbWVudHMgKGJlc2lkZXMgQGNoYXJzZXQpXCIsXG4gICAgICAvLyAgICAgeyBub2RlOiBhdFJ1bGUgfVxuICAgICAgLy8gICApXG4gICAgICAvLyB9IGVsc2UgcHJldiA9IGdldFByZXYocHJldilcbiAgICAgIHByZXYgPSBnZXRQcmV2KHByZXYpO1xuICAgIH0gd2hpbGUgKHByZXYpXG4gIH1cblxuICBpZiAoYXRSdWxlLm5vZGVzKSB7XG4gICAgcmV0dXJuIHJlc3VsdC53YXJuKFxuICAgICAgXCJJdCBsb29rcyBsaWtlIHlvdSBkaWRuJ3QgZW5kIHlvdXIgQGltcG9ydCBzdGF0ZW1lbnQgY29ycmVjdGx5LiBcIiArXG4gICAgICAgIFwiQ2hpbGQgbm9kZXMgYXJlIGF0dGFjaGVkIHRvIGl0LlwiLFxuICAgICAgeyBub2RlOiBhdFJ1bGUgfVxuICAgIClcbiAgfVxuXG4gIGNvbnN0IHBhcmFtcyA9IHZhbHVlUGFyc2VyKGF0UnVsZS5wYXJhbXMpLm5vZGVzXG4gIGNvbnN0IHN0bXQgPSB7XG4gICAgdHlwZTogXCJpbXBvcnRcIixcbiAgICBub2RlOiBhdFJ1bGUsXG4gICAgbWVkaWE6IFtdLFxuICB9XG5cbiAgLy8gcHJldHRpZXItaWdub3JlXG4gIGlmIChcbiAgICAhcGFyYW1zLmxlbmd0aCB8fFxuICAgIChcbiAgICAgIHBhcmFtc1swXS50eXBlICE9PSBcInN0cmluZ1wiIHx8XG4gICAgICAhcGFyYW1zWzBdLnZhbHVlXG4gICAgKSAmJlxuICAgIChcbiAgICAgIHBhcmFtc1swXS50eXBlICE9PSBcImZ1bmN0aW9uXCIgfHxcbiAgICAgIHBhcmFtc1swXS52YWx1ZSAhPT0gXCJ1cmxcIiB8fFxuICAgICAgIXBhcmFtc1swXS5ub2Rlcy5sZW5ndGggfHxcbiAgICAgICFwYXJhbXNbMF0ubm9kZXNbMF0udmFsdWVcbiAgICApXG4gICkge1xuICAgIHJldHVybiByZXN1bHQud2FybihgVW5hYmxlIHRvIGZpbmQgdXJpIGluICckeyAgYXRSdWxlLnRvU3RyaW5nKCkgIH0nYCwge1xuICAgICAgbm9kZTogYXRSdWxlLFxuICAgIH0pXG4gIH1cblxuICBpZiAocGFyYW1zWzBdLnR5cGUgPT09IFwic3RyaW5nXCIpIHN0bXQudXJpID0gcGFyYW1zWzBdLnZhbHVlXG4gIGVsc2Ugc3RtdC51cmkgPSBwYXJhbXNbMF0ubm9kZXNbMF0udmFsdWVcbiAgc3RtdC5mdWxsVXJpID0gc3RyaW5naWZ5KHBhcmFtc1swXSlcblxuICBpZiAocGFyYW1zLmxlbmd0aCA+IDIpIHtcbiAgICBpZiAocGFyYW1zWzFdLnR5cGUgIT09IFwic3BhY2VcIikge1xuICAgICAgcmV0dXJuIHJlc3VsdC53YXJuKFwiSW52YWxpZCBpbXBvcnQgbWVkaWEgc3RhdGVtZW50XCIsIHsgbm9kZTogYXRSdWxlIH0pXG4gICAgfVxuICAgIHN0bXQubWVkaWEgPSBzcGxpdChwYXJhbXMsIDIpXG4gIH1cblxuICByZXR1cm4gc3RtdFxufVxuXG5mdW5jdGlvbiBnZXRQcmV2KGl0ZW0pIHtcbiAgbGV0IHByZXYgPSBpdGVtLnByZXYoKVxuICB3aGlsZSAocHJldiAmJiBwcmV2LnR5cGUgPT09IFwiY29tbWVudFwiKSB7XG4gICAgcHJldiA9IHByZXYucHJldigpXG4gIH1cbiAgcmV0dXJuIHByZXZcbn0iXX0=